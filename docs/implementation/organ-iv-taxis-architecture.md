# OrganVM-IV-Taxis: Automation Engine Architecture

**Status:** Draft / RFC  
**Version:** 0.1.0  
**Date:** 2026-02-15  
**Context:** Design for a specialized "Organ" within the OrganVM system, focused on orchestration, automation, and Jules task management.

---

## 1. Executive Summary

This document defines the architectural contract for `organvm-iv-taxis`, serving as the **Automation Engine** for the OrganVM ecosystem. Its primary mandate is to orchestrate autonomous development tasks via the Jules Agent, enforce resource constraints (e.g., the 100-task daily limit), and manage the "Cascading" of dependencies across the distributed node network.

**Core Philosophy:** 
- **Local Control, Remote Execution:** Intents are defined locally or via centralized governance; execution is delegated to remote agents (Jules).
- **Governor Pattern:** Operations are gated by a strict control plane to prevent resource exhaustion and task sprawl.

---

## 2. System Architecture

### 2.1 The Organ Anatomy

*   **The Governor (`.github`):** The central control plane. Hosting reusable workflows and dispatch logic.
*   **The Engine (`orchestration-start-here`):** The executable core. Runs the logic for task analysis, delegation, and cascading.
*   **The Memory (`petasum-super-petasum`):** The state store. Tracks task history, failures, and preventing redundant work.
*   **The Network (`universal-node-network`):** The target environment where changes are applied.

### 2.2 Integration Points

| Integration Point | Type | Direction | Description |
| :--- | :--- | :--- | :--- |
| **`dispatch_trigger`** | Webhook | Inbound | Receives event payloads (e.g., `jules-fix` label) from other Organs. |
| **`jules_api`** | API | Outbound | Interface to the Jules Agent service for task execution. |
| **`petasum_log`** | Database/Log | Read/Write | Queries historical task data; writes new execution logs. |
| **`node_update`** | Git/PR | Outbound | Pushes code changes to downstream repositories. |

---

## 3. API Contracts & Data Schemas

### 3.1 The Dispatch Payload (Schema)

When an external system requests work from this Organ, it must adhere to this contract:

```json
{
  "event_id": "uuid-v4",
  "timestamp": "ISO-8601",
  "source_organ": "string (e.g., 'agentic-titan')",
  "intent": {
    "type": "REFACTOR | TEST_COVERAGE | DEPENDENCY_UPDATE",
    "priority": "HIGH | MEDIUM | LOW",
    "cascade_strategy": "DEPENDENCY | ATOMIC"
  },
  "target": {
    "repository": "username/repo",
    "branch": "main",
    "context_files": ["src/core/*", "package.json"]
  },
  "constraints": {
    "max_jules_tasks": 5,
    "timeout_seconds": 3600
  }
}
```

### 3.2 The Task Result (Schema)

Output generated by the Engine upon task completion:

```json
{
  "task_id": "jules-task-id",
  "status": "SUCCESS | FAILURE | SKIPPED",
  "resource_usage": {
    "jules_tasks_consumed": 1,
    "execution_time_ms": 4500
  },
  "artifacts": {
    "pr_url": "https://github.com/...",
    "diff_stat": "+150/-30"
  },
  "cascade_trigger": {
    "next_tasks": ["uuid-of-dependent-task"]
  }
}
```

---

## 4. Event Flows (The Cascade)

### 4.1 The "Dependency Cascade" Flow

1.  **Ingest:** The Governor receives a `dispatch_trigger`.
2.  **Gatekeeping:** The Engine checks the **Token Governor**:
    *   *Check:* `daily_tasks_used < 100`?
    *   *Check:* `is_duplicate_task(intent)` via Memory?
3.  **Execution (Root):** The Engine calls `start_new_jules_task` for the primary target.
4.  **Verification:** A "Validation Agent" (Local/CI) runs `test_runner` on the result.
5.  **Cascade Analysis:** If Success, the Engine queries the Dependency Graph.
    *   *Identify:* Which downstream nodes depend on this change?
6.  **Propagation:** The Engine generates new `dispatch_trigger` events for each dependent node, queueing them with `priority: CASCADE`.

---

## 5. Operational Runbooks

### 5.1 Runbook: Handling "Jules Sprawl" (Waste Management)

**Trigger:** Alert `HighTaskVolume` or `LowSuccessRate`.

**Procedure:**
1.  **Halt:** Execute `scripts/emergency_stop.sh` to pause the Dispatch Queue.
2.  **Analyze:** Query `petasum-super-petasum` for repetitive error patterns.
3.  **Refine:** Update the `intent` definitions in the Governor to be more specific (narrower scope).
4.  **Purge:** Clear pending low-priority tasks from the queue.
5.  **Resume:** Restart the queue in `RESTRICTED` mode (max 10 tasks/hour).

### 5.2 Runbook: Versioning Strategy

**Protocol:** Semantic Versioning (SemVer)
*   **Major:** Changes to the Dispatch Payload schema.
*   **Minor:** New `intent` types supported (e.g., adding `SECURITY_AUDIT`).
*   **Patch:** Bug fixes to the Cascading logic or Token Governor.

---

## 6. Security Protocols

*   **Authentication:** All inbound webhooks must be signed with `ORGAN_SECRET`.
*   **Scope Isolation:** Jules Agents are granted ephemeral tokens scoped *only* to the target repository, never organization-wide admin.
*   **Audit Trail:** Every dispatched task is immutably logged to `petasum-super-petasum` with the requester's ID.
*   **Circuit Breaker:** If 3 consecutive Jules tasks fail on a single repo, the repo is locked from further automation until manual review.

---

## 7. Future Roadmap

*   **Self-Healing:** Implementing automatic rollback of Cascades if a downstream node fails validation.
*   **Cost Optimization:** Intelligent scheduling of heavy tasks during off-peak API hours.
*   **Swarm Intelligence:** Integrating `agent--claude-smith` to perform pre-Jules analysis to refine prompts before spending a Jules task.
