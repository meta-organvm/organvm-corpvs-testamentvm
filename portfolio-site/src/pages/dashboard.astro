---
import Base from '../layouts/Base.astro';
import metrics from '../data/system-metrics.json';
---
<Base title="Dashboard" description="Live system health dashboard for the ORGANVM eight-organ system">
  <h1>System Dashboard</h1>
  <p class="intro">Auto-generated system health metrics. Last updated: <time>{new Date(metrics.generated).toLocaleDateString()}</time></p>

  <section>
    <h2>Registry Overview</h2>
    <div class="metric-grid">
      <div class="metric-card">
        <div class="value">{metrics.registry.total_repos}</div>
        <div class="label">Total Repos</div>
      </div>
      <div class="metric-card">
        <div class="value">{metrics.registry.operational_organs}/{metrics.registry.total_organs}</div>
        <div class="label">Organs Operational</div>
      </div>
      <div class="metric-card">
        <div class="value">{metrics.registry.ci_coverage}</div>
        <div class="label">CI Workflows</div>
      </div>
      <div class="metric-card">
        <div class="value">{metrics.registry.dependency_edges}</div>
        <div class="label">Dependency Edges</div>
      </div>
    </div>
  </section>

  <section>
    <h2>Implementation Status</h2>
    <table class="data-table">
      <thead>
        <tr><th>Status</th><th>Count</th></tr>
      </thead>
      <tbody>
        {Object.entries(metrics.registry.implementation_status).map(([status, count]) => (
          <tr>
            <td><code>{status}</code></td>
            <td>{count as number}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </section>

  <section>
    <h2>Flagship Vivification Progress</h2>
    {metrics.flagship_vivification.repos ? (
      <table class="data-table wide">
        <thead>
          <tr><th>Repo</th><th>Classification</th><th>Code Files</th><th>Test Files</th></tr>
        </thead>
        <tbody>
          {metrics.flagship_vivification.repos.map((r: any) => (
            <tr>
              <td><code>{r.repo}</code></td>
              <td>
                <span class={`status-badge ${r.classification.toLowerCase()}`}>
                  {r.classification}
                </span>
              </td>
              <td>{r.code_files}</td>
              <td>{r.test_files}</td>
            </tr>
          ))}
        </tbody>
      </table>
    ) : (
      <p class="note">Run <code>praxis-flagship-audit.py</code> to populate.</p>
    )}
  </section>

  <section>
    <h2>Essays</h2>
    <div class="metric-grid">
      <div class="metric-card">
        <div class="value">{metrics.essays.total}</div>
        <div class="label">Published</div>
      </div>
      <div class="metric-card">
        <div class="value">~111K</div>
        <div class="label">Words</div>
      </div>
    </div>
  </section>

  <section>
    <h2>PRAXIS Targets</h2>
    <table class="data-table wide">
      <thead>
        <tr><th>Target</th><th>Goal</th><th>Current</th></tr>
      </thead>
      <tbody>
        {Object.entries(metrics.praxis_targets).map(([key, val]: [string, any]) => (
          <tr>
            <td>{key.replace(/_/g, ' ')}</td>
            <td>{val.target}</td>
            <td>{val.current}</td>
          </tr>
        ))}
      </tbody>
    </table>
  </section>

  <section>
    <h2>Sprint History</h2>
    <div class="timeline">
      {metrics.sprint_history.map((sprint: any) => (
        <div class="timeline-item">
          <div class="date">{sprint.date}</div>
          <strong>{sprint.name}</strong> â€” {sprint.focus}
          <p>{sprint.deliverables}</p>
        </div>
      ))}
    </div>
  </section>
</Base>

<style>
  .intro { color: var(--color-text-muted); }
  .data-table {
    border-collapse: collapse;
    width: 100%;
    margin: var(--space-md) 0;
  }
  .data-table.wide { max-width: 48rem; }
  .data-table th, .data-table td {
    padding: var(--space-sm) var(--space-md);
    text-align: left;
    border-bottom: 1px solid var(--color-border-light);
  }
  .data-table th {
    font-family: var(--font-heading);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-text-muted);
  }
  .status-badge {
    font-size: 0.75rem;
    padding: 0.15em 0.5em;
    border-radius: 3px;
    font-weight: 600;
  }
  .status-badge.substantial { background: #d4edda; color: #155724; }
  .status-badge.partial { background: #fff3cd; color: #856404; }
  .status-badge.minimal { background: #f8d7da; color: #721c24; }
  .status-badge.skeleton { background: #e2e3e5; color: #383d41; }
  .note { color: var(--color-text-muted); font-style: italic; }
</style>
